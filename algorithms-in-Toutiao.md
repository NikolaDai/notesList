# 深入理解今日头条推荐系统的文本分析算法
推荐系统在日常使用的APP中随处可见，比如今日头条、淘宝APP、美团外卖等等。今日头条主要使用的是内容推荐系统。近日，今日头条公布了其算法原理，本文将从内容分析算法原理进行深入解读，以期让更多读者能够了解今日头条的推荐系统原理。
内容推荐系统的本质上要实现内容按需分配的目标，即解决用户、环境和资讯的匹配。这种匹配可以用函数y=F(x<sub>i</sub>,x<sub>u</sub>,x<sub>c</sub>)来表示，其中。x<sub>i</sub>表示内容特征，每种内容都有自己的特征，需要做好内容的特征标签实现好的推荐；x<sub>u</sub>表示用户特征，包括兴趣、职业、年龄、性别等，还有其他一些隐式用户兴趣；x<sub>c</sub>表示环境特征，包含地理位置等。函数的输出是根据这个三个特征输入而输出的（推荐）内容。
文本分析的主要任务之一是给文本添加文本标签（特征），该标签可用于构建用户兴趣标签、帮助内容推荐以及生成频道内容。
今日头条公布算法中的样例文本如下：
#### 莎娃连续17次不敌小威
心魔作怪，俄罗斯美女莎拉波娃连续第17次不敌小威廉姆斯，后者时隔3年重返温网女单决赛，将与90后小将穆古拉扎争夺冠军。

北京时间今天凌晨，2015温网锦标赛结束了女单半决赛展开争夺，头号种子、世界第一小威廉姆斯以6比2、6比4战胜4号种子莎拉波娃，取得对对手的17连胜，继2012年后再度跻身决赛。小威将与20号种子穆古拉扎争夺冠军，后者以6比2、3比6和6比3力克13号种子、波兰名将A·拉德万斯卡，首次闯进大满贯决赛。

出生于1993年的穆古拉扎，生于委内瑞拉，在西班牙长大，身高力强，曾在去年法网第二轮爆冷击败小威，一战成名，并最终跻身8强。她表示，非常期待与小威的对决，夺取大满贯冠军是她的梦想。

小威和穆古拉扎年龄相差12岁，是王朝复辟，还是开创新纪元，让我们拭目以待明天的女单决赛。</br>

![avatar](https://pic.36krcnd.com/avatar/201801/15160538/rnky59il2od10fn9.jpeg)
<center>图一：示例</center></br>
从头条给出的图一中，文本分析完成的主要任务是：进行分类（一级分类【体育新闻】、二级分类【网球】）；提取关键词及高亮关键词。今日头条推荐系统主要抽取的文本特征包括以下几类。首先是<b>语义标签类特征</b>，显式为文章打上语义标签，见图三。这部分标签是由人定义的特征，每个标签有明确的意义，标签体系是预定义的。此外还有<b>隐式语义特征</b>，主要是topic特征和关键词特征，其中<b>topic特征是对于词概率分布的描述</b>，无明确意义；而<b>关键词特征会基于一些统一特征描述</b>，无明确集合。虽然隐式语义标签可以很好的帮助推荐，但是语义标签也是非常需要的，比如频道需要有明确定义的分类内容和容易理解的文本标签体系。今日头条指出，语义标签的效果是检查一个公司NLP技术水平的试金石。语义标签需要持续标注，新名词概念不断出现，标注需要不断迭代。</br>

![avatar1](https://pic.36krcnd.com/avatar/201801/15160549/1o62umwiaef0gado.jpeg)
<center>图二：示例</center></br>
图二对文本进行了另一个角度的分析，分析出文章profile（同类词、同义词）以及新版实体词。
解决文本相似度特征非常重要，主要方法是根据判断相似文章的主题、行文、主体等内容，根据这些特征做线上策略。</br>

![avatar2](https://pic.36krcnd.com/avatar/201801/15160711/d0ufcrvlkdf6a0tx.jpeg)
<center>图三：头条语义标签的特征和使用场景</center></br>
文本分析过程会对不同的特征进行分层，分层的理由见图四。</br>

![avatar3](https://pic.36krcnd.com/avatar/201801/15160734/cazc3cklyyd66eic.jpeg!)
<center>图四：根据特征进行分层</center></br>
今日头条的文本分类是层次化的，见图五，最上面Root，下面第一层的分类是像科技、体育、财经、娱乐，体育这样的大类，再下面细分足球、篮球、乒乓球、网球、田径、游泳...，足球再细分国际足球、中国足球，中国足球又细分中甲、中超、国家队...，相比单独的分类器，利用层次化文本分类算法能更好地解决数据倾斜的问题。有一些例外是，如果要提高召回，可以看到我们连接了一些飞线。这套架构通用，但根据不同的问题难度，每个元分类器可以异构，像有些分类SVM效果很好，有些要结合CNN，有些要结合RNN再处理一下。</br>
![avatar4](https://pic.36krcnd.com/avatar/201801/15160820/93sw0u30n1l16onv.jpeg)
<center>图五：层次化文本分类</center></br>
最后，介绍一下文本分析中比较重要的实体词识别算法。图六是一个实体词识别算法的case。基于分词结果和词性标注选取候选，期间可能需要根据知识库做一些拼接，有些实体是几个词的组合，要确定哪几个词结合在一起能映射实体的描述。如果结果映射多个实体还要通过词向量、topic分布甚至词频本身等去歧，最后计算一个相关性模型。</br>
![avatar5](https://pic.36krcnd.com/avatar/201801/15160833/mecnwdsmk1puqtdd.jpeg)
<center>图六：实体词识别算法</center>
